<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Variable_summary (irmin-bench.Irmin_traces.Trace_stat_summary_utils.Variable_summary)</title><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">irmin-bench</a> &#x00BB; <a href="../../index.html">Irmin_traces</a> &#x00BB; <a href="../index.html">Trace_stat_summary_utils</a> &#x00BB; Variable_summary</nav><header class="odoc-preamble"><h1>Module <code><span>Trace_stat_summary_utils.Variable_summary</span></code></h1><p>Functional summary for a variable that has zero or more occurences per period. <code>accumulate</code> is expected to be called <code>in_period_count</code> times before <code>finalise</code> is.</p></header><nav class="odoc-toc"><ul><li><a href="#stats-gathered">Stats Gathered</a></li><li><a href="#histograms">Histograms</a></li><li><a href="#log-scale">Log Scale</a></li><li><a href="#periods-are-decoupled-from-samples">Periods are Decoupled from Samples</a></li><li><a href="#possible-future-evolutions">Possible Future Evolutions</a></li></ul></nav><div class="odoc-content"><h4 id="stats-gathered"><a href="#stats-gathered" class="anchor"></a>Stats Gathered</h4><ul><li>Global (non-nan) max, argmax, min, argmin and mean of the variable.</li><li>The very last non-nan sample encountered minus the very first non-nan sample encountered.</li><li>Global histogram made of <code>distribution_bin_count</code> bins. Option: <code>distribution_scale</code> to control the spreading scale of the bins, either on a linear or a log scale. Computed using Bentov.</li><li>A curve made of <code>out_sample_count</code> points. Options: <code>evolution_smoothing</code> to control the smoothing, either using EMA, or no smoothing at all.</li></ul><h4 id="histograms"><a href="#histograms" class="anchor"></a>Histograms</h4><p>The histograms are all computed using https://github.com/barko/bentov.</p><p><code>Bentov</code> computes dynamic histograms without the need for a priori informations on the distributions, while maintaining a constant memory space and a marginal CPU footprint.</p><p>The implementation of that library is pretty straightforward, but not perfect; the CPU footprint doesn't scale well with the number of bins.</p><p>The computed histograms depend on the order of the operations, some marginal unsabilities are to be expected.</p><p><code>Bentov</code> is good at spreading the bins on the input space. Since some histograms will be shown on a log plot, the log10 of those values is passed to <code>Bentov</code> instead, but the json will store real seconds.</p><h4 id="log-scale"><a href="#log-scale" class="anchor"></a>Log Scale</h4><p>When a variable has to be displayed on a log scale, the <code>scale</code> option can be set to <code>`Log</code> in order for some adjustments to be made.</p><p>In the histogram, the bins have to spread on a log scale.</p><p>When smoothing the evolution, the EMA decay has to be calculated on a log scale.</p><p>Gotcha: All the input samples should be strictly greater than 0, so that they don't fail their conversion to log.</p><h4 id="periods-are-decoupled-from-samples"><a href="#periods-are-decoupled-from-samples" class="anchor"></a>Periods are Decoupled from Samples</h4><p>When a <code>Variable_summary</code> (<code>vs</code>) is created, the number of periods has to be declared right away through the <code>in_period_count</code> parameter, but <code>vs</code> is very flexible when it comes to the number of samples shown to it on each period.</p><p>The simplest use case of <code>vs</code> is when there is exactly one sample for each period. In that case, <code>accumulate acc samples</code> is called using a list of length 1. For example: when a period corresponds to a cycle of an algorithm, and the variable is a timestamp.</p><p>The more advanced use case of <code>vs</code> is when there are a varying number a samples for each period. For example: when a period corresponds to a cycle of an algorithm, and the variable is the time taken by a buffer flush that may happen 0, 1 or more times per cycle.</p><p>In that later case, the <code>evolution</code> curve may contain NaNs before and after sample points.</p><h4 id="possible-future-evolutions"><a href="#possible-future-evolutions" class="anchor"></a>Possible Future Evolutions</h4><ul><li>A period-wise histogram, similar to Grafana's heatmaps: &quot;A heatmap is like a histogram, but over time where each time slice represents its own histogram.&quot;.</li></ul><ul><li>Variance evolution. Either without smoothing or using exponential moving variance (see wikipedia).</li></ul><ul><li>Global variance.</li></ul><ul><li>Quantile evolution.</li></ul><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.max_value" class="def record field anchored"><a href="#type-t.max_value" class="anchor"></a><code><span>max_value : float * int;</span></code></li><li id="type-t.min_value" class="def record field anchored"><a href="#type-t.min_value" class="anchor"></a><code><span>min_value : float * int;</span></code></li><li id="type-t.mean" class="def record field anchored"><a href="#type-t.mean" class="anchor"></a><code><span>mean : float;</span></code></li><li id="type-t.diff" class="def record field anchored"><a href="#type-t.diff" class="anchor"></a><code><span>diff : float;</span></code></li><li id="type-t.distribution" class="def record field anchored"><a href="#type-t.distribution" class="anchor"></a><code><span>distribution : <a href="../index.html#type-histo">histo</a>;</span></code></li><li id="type-t.evolution" class="def record field anchored"><a href="#type-t.evolution" class="anchor"></a><code><span>evolution : <a href="../index.html#type-curve">curve</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-t"><a href="#val-t" class="anchor"></a><code><span><span class="keyword">val</span> t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-acc"><a href="#type-acc" class="anchor"></a><code><span><span class="keyword">type</span> acc</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_acc"><a href="#val-create_acc" class="anchor"></a><code><span><span class="keyword">val</span> create_acc : 
  <span>evolution_smoothing:<span>[ <span>`Ema of float * float</span> <span>| `None</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>evolution_resampling_mode:<span>[ `Interpolate <span>| `Next_neighbor</span> <span>| `Prev_neighbor</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>distribution_bin_count:int <span class="arrow">&#45;&gt;</span></span>
  <span>scale:<span>[ `Linear <span>| `Log</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>in_period_count:int <span class="arrow">&#45;&gt;</span></span>
  <span>out_sample_count:int <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-acc">acc</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-accumulate"><a href="#val-accumulate" class="anchor"></a><code><span><span class="keyword">val</span> accumulate : <span><a href="#type-acc">acc</a> <span class="arrow">&#45;&gt;</span></span> <span><span>float list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-acc">acc</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalise"><a href="#val-finalise" class="anchor"></a><code><span><span class="keyword">val</span> finalise : <span><a href="#type-acc">acc</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div></div></body></html>