(library
 (name test_pack)
 (modules test_pack multiple_instances migration)
 (libraries alcotest fmt common index irmin irmin-test irmin-pack logs lwt
   lwt.unix))

(executable
 (name test)
 (modules test)
 (libraries alcotest digestif.ocaml irmin irmin-test test_pack))

(rule
 (alias runtest)
 (package irmin-pack)
 (deps
  (source_tree data/version_1))
 (action
  (run ./test.exe -q --color=always)))

(executable
 (name bench)
 (modules bench)
 (libraries irmin_pack irmin-test.bench))

(rule
 (alias runbench)
 (action
  (run ./bench.exe)))

(library
 (name common)
 (modules common)
 (libraries alcotest index irmin irmin-test irmin-pack logs lwt))
