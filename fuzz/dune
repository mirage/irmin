(executable
 (name       fuzz_types)
 (libraries  digestif.c crowbar irmin)
 ;; Use a rewriter to fill in `[% generate_record n]` and `[% generate_variant n]`.
 (preprocess (action (run fuzz/rewriter/rewriter.exe %{input-file}))))

;; Start fuzzing when calling `dune build @fuzz`.
(alias
 (name fuzz)
 (deps (source_tree ./input) fuzz_types.exe)
 (action
  (run afl-fuzz -i ./input -o output ./fuzz_types.exe @@)))

(rule
 (alias runtest)
 (package irmin-fuzz)
 (deps fuzz_types.exe)
 (action progn))
