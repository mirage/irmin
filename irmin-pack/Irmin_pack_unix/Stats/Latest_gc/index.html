<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Latest_gc (irmin-pack.Irmin_pack_unix.Stats.Latest_gc)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">irmin-pack</a> &#x00BB; <a href="../../index.html">Irmin_pack_unix</a> &#x00BB; <a href="../index.html">Stats</a> &#x00BB; Latest_gc</nav><header class="odoc-preamble"><h1>Module <code><span>Stats.Latest_gc</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-rusage"><a href="#type-rusage" class="anchor"></a><code><span><span class="keyword">type</span> rusage</span><span> = </span><span>{</span></code><ol><li id="type-rusage.maxrss" class="def record field anchored"><a href="#type-rusage.maxrss" class="anchor"></a><code><span>maxrss : int64;</span></code></li><li id="type-rusage.minflt" class="def record field anchored"><a href="#type-rusage.minflt" class="anchor"></a><code><span>minflt : int64;</span></code></li><li id="type-rusage.majflt" class="def record field anchored"><a href="#type-rusage.majflt" class="anchor"></a><code><span>majflt : int64;</span></code></li><li id="type-rusage.inblock" class="def record field anchored"><a href="#type-rusage.inblock" class="anchor"></a><code><span>inblock : int64;</span></code></li><li id="type-rusage.oublock" class="def record field anchored"><a href="#type-rusage.oublock" class="anchor"></a><code><span>oublock : int64;</span></code></li><li id="type-rusage.nvcsw" class="def record field anchored"><a href="#type-rusage.nvcsw" class="anchor"></a><code><span>nvcsw : int64;</span></code></li><li id="type-rusage.nivcsw" class="def record field anchored"><a href="#type-rusage.nivcsw" class="anchor"></a><code><span>nivcsw : int64;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rusage_t"><a href="#val-rusage_t" class="anchor"></a><code><span><span class="keyword">val</span> rusage_t : <span><a href="#type-rusage">rusage</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ocaml_gc"><a href="#type-ocaml_gc" class="anchor"></a><code><span><span class="keyword">type</span> ocaml_gc</span><span> = </span><span>{</span></code><ol><li id="type-ocaml_gc.minor_words" class="def record field anchored"><a href="#type-ocaml_gc.minor_words" class="anchor"></a><code><span>minor_words : float;</span></code></li><li id="type-ocaml_gc.promoted_words" class="def record field anchored"><a href="#type-ocaml_gc.promoted_words" class="anchor"></a><code><span>promoted_words : float;</span></code></li><li id="type-ocaml_gc.major_words" class="def record field anchored"><a href="#type-ocaml_gc.major_words" class="anchor"></a><code><span>major_words : float;</span></code></li><li id="type-ocaml_gc.minor_collections" class="def record field anchored"><a href="#type-ocaml_gc.minor_collections" class="anchor"></a><code><span>minor_collections : int;</span></code></li><li id="type-ocaml_gc.major_collections" class="def record field anchored"><a href="#type-ocaml_gc.major_collections" class="anchor"></a><code><span>major_collections : int;</span></code></li><li id="type-ocaml_gc.heap_words" class="def record field anchored"><a href="#type-ocaml_gc.heap_words" class="anchor"></a><code><span>heap_words : int;</span></code></li><li id="type-ocaml_gc.compactions" class="def record field anchored"><a href="#type-ocaml_gc.compactions" class="anchor"></a><code><span>compactions : int;</span></code></li><li id="type-ocaml_gc.top_heap_words" class="def record field anchored"><a href="#type-ocaml_gc.top_heap_words" class="anchor"></a><code><span>top_heap_words : int;</span></code></li><li id="type-ocaml_gc.stack_size" class="def record field anchored"><a href="#type-ocaml_gc.stack_size" class="anchor"></a><code><span>stack_size : int;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ocaml_gc_t"><a href="#val-ocaml_gc_t" class="anchor"></a><code><span><span class="keyword">val</span> ocaml_gc_t : <span><a href="#type-ocaml_gc">ocaml_gc</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-duration"><a href="#type-duration" class="anchor"></a><code><span><span class="keyword">type</span> duration</span><span> = </span><span>{</span></code><ol><li id="type-duration.wall" class="def record field anchored"><a href="#type-duration.wall" class="anchor"></a><code><span>wall : float;</span></code></li><li id="type-duration.sys" class="def record field anchored"><a href="#type-duration.sys" class="anchor"></a><code><span>sys : float;</span></code></li><li id="type-duration.user" class="def record field anchored"><a href="#type-duration.user" class="anchor"></a><code><span>user : float;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Timings in seconds</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-duration_t"><a href="#val-duration_t" class="anchor"></a><code><span><span class="keyword">val</span> duration_t : <span><a href="#type-duration">duration</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-step"><a href="#type-step" class="anchor"></a><code><span><span class="keyword">type</span> step</span><span> = </span><span>{</span></code><ol><li id="type-step.duration" class="def record field anchored"><a href="#type-step.duration" class="anchor"></a><code><span>duration : <a href="#type-duration">duration</a>;</span></code></li><li id="type-step.rusage" class="def record field anchored"><a href="#type-step.rusage" class="anchor"></a><code><span>rusage : <a href="#type-rusage">rusage</a>;</span></code></li><li id="type-step.ocaml_gc" class="def record field anchored"><a href="#type-step.ocaml_gc" class="anchor"></a><code><span>ocaml_gc : <a href="#type-ocaml_gc">ocaml_gc</a>;</span></code></li><li id="type-step.index" class="def record field anchored"><a href="#type-step.index" class="anchor"></a><code><span>index : <span class="xref-unresolved">Irmin_pack_unix__.Stats_intf.Index</span>.S.t;</span></code></li><li id="type-step.pack_store" class="def record field anchored"><a href="#type-step.pack_store" class="anchor"></a><code><span>pack_store : <span class="xref-unresolved">Irmin_pack_unix__.Stats_intf.Pack_store.t</span>;</span></code></li><li id="type-step.inode" class="def record field anchored"><a href="#type-step.inode" class="anchor"></a><code><span>inode : <a href="../../../Irmin_pack/Stats/Inode/index.html#type-t">Irmin_pack.Stats.Inode.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Stats gathered for one worker step</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-step_t"><a href="#val-step_t" class="anchor"></a><code><span><span class="keyword">val</span> step_t : <span><a href="#type-step">step</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-worker"><a href="#type-worker" class="anchor"></a><code><span><span class="keyword">type</span> worker</span><span> = </span><span>{</span></code><ol><li id="type-worker.initial_maxrss" class="def record field anchored"><a href="#type-worker.initial_maxrss" class="anchor"></a><code><span>initial_maxrss : int64;</span></code></li><li id="type-worker.initial_heap_words" class="def record field anchored"><a href="#type-worker.initial_heap_words" class="anchor"></a><code><span>initial_heap_words : int;</span></code></li><li id="type-worker.initial_top_heap_words" class="def record field anchored"><a href="#type-worker.initial_top_heap_words" class="anchor"></a><code><span>initial_top_heap_words : int;</span></code></li><li id="type-worker.initial_stack_size" class="def record field anchored"><a href="#type-worker.initial_stack_size" class="anchor"></a><code><span>initial_stack_size : int;</span></code></li><li id="type-worker.steps" class="def record field anchored"><a href="#type-worker.steps" class="anchor"></a><code><span>steps : <span><span>(string * <a href="#type-step">step</a>)</span> list</span>;</span></code></li><li id="type-worker.files" class="def record field anchored"><a href="#type-worker.files" class="anchor"></a><code><span>files : <span><span>(string * <span class="xref-unresolved">Optint</span>.Int63.t)</span> list</span>;</span></code></li><li id="type-worker.objects_traversed" class="def record field anchored"><a href="#type-worker.objects_traversed" class="anchor"></a><code><span>objects_traversed : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-worker.suffix_transfers" class="def record field anchored"><a href="#type-worker.suffix_transfers" class="anchor"></a><code><span>suffix_transfers : <span><span class="xref-unresolved">Optint</span>.Int63.t list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Stats produced by the worker. They are meant to be transmited to the parent process through the gc result JSON file.</p><p><code>steps</code> is the list of all step names associated with the timing of these steps plus stats recorded at the end of the step. An association lists is used here instead of types because in the future the exact list of tasks may change and we don't want the rigidity of types, especially because these informations will end up appearing in a file format.</p><p>Since the worker lives in a fork, <code>rusage</code> and <code>ocaml_gc</code> contain stats that are impacted by what happened in the main process, prior to the fork. The <code>init_*</code> fields reflect this.</p><p>The total wall time of the worker is the sum of all <code>wall</code> fields in <code>steps</code>.</p><p><code>files</code> contains the size of files created by the GC. And association list is used instead of plain types for the same reason as <code>steps</code>/</p><p><code>suffix_transfers</code> contains an int for each transfer loop to the new suffix. That integer corresponds to the number of bytes copied during that loop. The sum of these integers is equal to the &quot;suffix&quot; step in <code>files</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-worker_t"><a href="#val-worker_t" class="anchor"></a><code><span><span class="keyword">val</span> worker_t : <span><a href="#type-worker">worker</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stats"><a href="#type-stats" class="anchor"></a><code><span><span class="keyword">type</span> stats</span><span> = </span><span>{</span></code><ol><li id="type-stats.generation" class="def record field anchored"><a href="#type-stats.generation" class="anchor"></a><code><span>generation : int;</span></code></li><li id="type-stats.commit_offset" class="def record field anchored"><a href="#type-stats.commit_offset" class="anchor"></a><code><span>commit_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-stats.before_suffix_start_offset" class="def record field anchored"><a href="#type-stats.before_suffix_start_offset" class="anchor"></a><code><span>before_suffix_start_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-stats.before_suffix_end_offset" class="def record field anchored"><a href="#type-stats.before_suffix_end_offset" class="anchor"></a><code><span>before_suffix_end_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-stats.after_suffix_start_offset" class="def record field anchored"><a href="#type-stats.after_suffix_start_offset" class="anchor"></a><code><span>after_suffix_start_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-stats.after_suffix_end_offset" class="def record field anchored"><a href="#type-stats.after_suffix_end_offset" class="anchor"></a><code><span>after_suffix_end_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-stats.steps" class="def record field anchored"><a href="#type-stats.steps" class="anchor"></a><code><span>steps : <span><span>(string * <a href="#type-duration">duration</a>)</span> list</span>;</span></code></li><li id="type-stats.worker" class="def record field anchored"><a href="#type-stats.worker" class="anchor"></a><code><span>worker : <a href="#type-worker">worker</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>All the stats for a single successful GC run.</p><p><code>commit_offset</code> is the offset of the commit provided by the irmin user.</p><p>The <code>before_*</code> (and <code>after_*</code>) offsets track the state of the suffix before (and after) the GC.</p><p><code>steps</code> has a similar meaning as <code>steps</code> in <code>worker</code> but for the main process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stats_t"><a href="#val-stats_t" class="anchor"></a><code><span><span class="keyword">val</span> stats_t : <span><a href="#type-stats">stats</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <span><span class="xref-unresolved">Irmin_pack_unix__.Stats_intf.Latest_gc.stats</span> option</span></span></code></div><div class="spec-doc"><p><code>Latest_gc.t</code> is an <code>option</code> type because before the first gc end, there are no gc stats to expose.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-t"><a href="#val-t" class="anchor"></a><code><span><span class="keyword">val</span> t : <span><span><a href="#type-stats">stats</a> option</span> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stat"><a href="#type-stat" class="anchor"></a><code><span><span class="keyword">type</span> stat</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-export"><a href="#val-export" class="anchor"></a><code><span><span class="keyword">val</span> export : <span><a href="#type-stat">stat</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-new_suffix_end_offset_before_finalise"><a href="#val-new_suffix_end_offset_before_finalise" class="anchor"></a><code><span><span class="keyword">val</span> new_suffix_end_offset_before_finalise : <span><a href="#type-worker">worker</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalise_duration"><a href="#val-finalise_duration" class="anchor"></a><code><span><span class="keyword">val</span> finalise_duration : <span><a href="#type-stats">stats</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Time taken by the GC finalisation in seconds. It includes the time it took to wait for the worker to finish in case of <code>~wait:true</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-total_duration"><a href="#val-total_duration" class="anchor"></a><code><span><span class="keyword">val</span> total_duration : <span><a href="#type-stats">stats</a> <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Total wall duration of the GC in seconds, from the call to GC and to the end of finalise. This duration contains the time it takes for the user to trigger a finalise while the worker is over.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalise_suffix_transfer"><a href="#val-finalise_suffix_transfer" class="anchor"></a><code><span><span class="keyword">val</span> finalise_suffix_transfer : <span><a href="#type-stats">stats</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>finalise_suffix_transfer stats</code> is the number of bytes appended to the new suffix by the finalise step of the GC. Before this, the worker already appended bytes to the new suffix, this is reported in <code>worker.suffix_transfers</code>.</p></div></div></div></body></html>