<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dispatcher (irmin-tezos.Irmin_tezos.Store.Internal.Dispatcher)</title><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">irmin-tezos</a> &#x00BB; <a href="../../../index.html">Irmin_tezos</a> &#x00BB; <a href="../../index.html">Store</a> &#x00BB; <a href="../index.html">Internal</a> &#x00BB; Dispatcher</nav><header class="odoc-preamble"><h1>Module <code><span>Internal.Dispatcher</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Fm"><a href="#module-Fm" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Fm/index.html">Fm</a></span><span> : <a href="../../../../../irmin-pack/Irmin_pack_unix/File_manager/module-type-S/index.html">Irmin_pack_unix.File_manager.S</a></span></code></div><div class="spec-doc"><p>Abstraction that governs the lifetime of the various files that are part of a pack store (except the branch store).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-v"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : <span><a href="Fm/index.html#type-t">Fm.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <span>[&gt; <a href="Fm/Errs/index.html#type-t">Fm.Errs.t</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_exn"><a href="#val-read_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>len:int <span class="arrow">&#45;&gt;</span></span>
  <span>?volume_identifier:<a href="../../../../../irmin-pack/Irmin_pack_unix/Lower/index.html#type-volume_identifier">Irmin_pack_unix.Lower.volume_identifier</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bytes <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../../irmin-pack/Irmin_pack_unix/Lower/index.html#type-volume_identifier">Irmin_pack_unix.Lower.volume_identifier</a> option</span></span></code></div><div class="spec-doc"><p><code>read_exn t ~off ~len buffer</code> writes into <code>buffer</code> the bytes from <code>off</code> to <code>off+len</code>. If the read occurred, in a lower volume, its identifier is returned.</p><p>If you know which volume to read from in the lower, provide <code>volume_identifier</code> to skip checking the prefix.</p><p>Note: <code>read_exn</code> is the only read function that supports reading in the lower.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_range_exn"><a href="#val-read_range_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_range_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>min_len:int <span class="arrow">&#45;&gt;</span></span>
  <span>max_len:int <span class="arrow">&#45;&gt;</span></span>
  <span>?volume_identifier:<a href="../../../../../irmin-pack/Irmin_pack_unix/Lower/index.html#type-volume_identifier">Irmin_pack_unix.Lower.volume_identifier</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bytes <span class="arrow">&#45;&gt;</span></span>
  int * <span><a href="../../../../../irmin-pack/Irmin_pack_unix/Lower/index.html#type-volume_identifier">Irmin_pack_unix.Lower.volume_identifier</a> option</span></span></code></div><div class="spec-doc"><p>Same as <code>read_exn</code>, the amount read is <code>max_len</code> if possible or at least <code>min_len</code> if reading more would step over a hole in the sparse file. Returns the actually read length and optionnaly the volume where the data was found.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_offset"><a href="#val-end_offset" class="anchor"></a><code><span><span class="keyword">val</span> end_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>end_offset</code> is the end offsets of the pack entries, counting that the prefix doesn't start at 0. It counts the entries not yet flushed from the prefix.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-suffix_start_offset"><a href="#val-suffix_start_offset" class="anchor"></a><code><span><span class="keyword">val</span> suffix_start_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>suffix_start_offset</code> is the offsets of the first pack entry in the suffix. All pack entries in the prefix fit below <code>suffix_start_offset</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-offset_of_soff"><a href="#val-offset_of_soff" class="anchor"></a><code><span><span class="keyword">val</span> offset_of_soff : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>offset_of_soff t suffix_off</code> converts a suffix offset into a (global) offset.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-soff_of_offset"><a href="#val-soff_of_offset" class="anchor"></a><code><span><span class="keyword">val</span> soff_of_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>soff_of_offset t global_offset</code> converts a global offset to a suffix offset.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_seq_exn"><a href="#val-read_seq_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_seq_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>len:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <a href="../../../../../irmin/Irmin/Export_for_backends/Seq/index.html#type-t">Irmin.Export_for_backends.Seq.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_bytes_exn"><a href="#val-read_bytes_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_bytes_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>f:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>len:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>read_bytes_exn</code> reads a slice of the global offset space defined by <code>off</code> and <code>len</code>.</p><p>The calls to <code>f</code> ignore the objects boundaries (i.e. the string passed to <code>f</code> will most of the time not be the beginning of an object).</p><p>The strings passed to <code>f</code> are safe. They can be kept around, they are not the result of an <code>unsafe_to_string</code> conversion.</p><p>The call will fail if the <code>(off, len)</code> range is invalid. It will succeed in these cases:</p><ul><li>If the range designates a slice of the suffix.</li><li>If the range designates a slice of contiguous live bytes in the prefix</li><li>If the range designates a slice of contiguous live bytes that starts in the prefix and ends in the suffix. This implies that the last chunk of the prefix is contiguous to the start of the suffix.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_valid_offset"><a href="#val-next_valid_offset" class="anchor"></a><code><span><span class="keyword">val</span> next_valid_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Optint</span>.Int63.t option</span></span></code></div><div class="spec-doc"><p><code>next_valid_offset t ~off</code> returns an offset greater or equal to <code>off</code> that can be read. Used to iterate over the entries while skipping over the holes in the sparse file.</p></div></div></div></body></html>