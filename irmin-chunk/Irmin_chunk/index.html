<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Irmin_chunk (irmin-chunk.Irmin_chunk)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">irmin-chunk</a> &#x00BB; Irmin_chunk</nav><h1>Module <code>Irmin_chunk</code></h1><p>This package provides an Irmin backend to cut raw contents into blocks of the same size, while preserving the keys used in the store. It can be used to optimize space usage when dealing with large files or as an intermediate layer for a raw block device backend.</p><nav class="toc"><ul><li><a href="#managing-chunks">Managing Chunks</a></li></ul></nav></header><section><header><h2 id="managing-chunks"><a href="#managing-chunks" class="anchor"></a>Managing Chunks</h2><p>This module exposes functors to store raw contents into append-only stores as chunks of same size. It exposes the <span class="xref-unresolved" title="unresolved reference to &quot;AO&quot;"><span>AO</span></span> functor which split the raw contents into <code>Data</code> blocks, addressed by <code>Node</code> blocks. That's the usual rope-like representation of strings, but chunk trees are always built as perfectly well-balanced and blocks are addressed by their hash (or by the stable keys returned by the underlying store).</p><p>A chunk has the following structure:</p><pre>     --------------------------      --------------------------
     | uint8_t type            |     | uint8_t type            |
     ---------------------------     ---------------------------
     | uint16_t                |     | uint64_t                |
     ---------------------------     ---------------------------
     | key children[length]    |     | byte data[length]       |
     ---------------------------     ---------------------------</pre><p><code>type</code> is either <code>Data</code> (0) or <code>Index</code> (1). If the chunk contains data, <code>length</code> is the payload length. Otherwise it is the number of children that the node has.</p><p>It also exposes <span class="xref-unresolved" title="unresolved reference to &quot;AO_stable&quot;"><span>AO_stable</span></span> which -- as <span class="xref-unresolved" title="unresolved reference to &quot;AO&quot;"><span>AO</span></span> does -- stores raw contents into chunks of same size. But it also preserves the nice property that values are addressed by their hash, instead of by the hash of the root chunk node as is the case for <span class="xref-unresolved" title="unresolved reference to &quot;AO&quot;"><span>AO</span></span>.</p></header><dl><dt class="spec value" id="val-chunk_size"><a href="#val-chunk_size" class="anchor"></a><code><span class="keyword">val</span> chunk_size : <span>int <a href="../../irmin/Irmin__/Conf/index.html#type-key">Irmin.Private.Conf.key</a></span></code></dt><dd><p><code>chunk_size</code> is the configuration key to configure chunk size. By default, it is set to 4666, so that payload and metadata can be stored in a 4K block.</p></dd></dl><dl><dt class="spec value" id="val-config"><a href="#val-config" class="anchor"></a><code><span class="keyword">val</span> config : <span>?&#8288;config:<a href="../../irmin/Irmin/index.html#type-config">Irmin.config</a></span> <span>&#45;&gt;</span> <span>?&#8288;size:int</span> <span>&#45;&gt;</span> <span>?&#8288;min_size:int</span> <span>&#45;&gt;</span> <span>?&#8288;chunking:<span>[ `Max <span>| `Best_fit</span> ]</span></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="../../irmin/Irmin/index.html#type-config">Irmin.config</a></code></dt><dd><p><code>config ?config ?size ?min_size ()</code> is the configuration value extending the optional <code>config</code> with bindings associating <a href="index.html#val-chunk_size"><span>chunk_size</span></a> to <code>size</code>.</p><p>If <code>chunking</code> is <code>Best_fit</code> (the default), the size of new chunks will be of maximum <code>max_size</code> but could be smaller if they don't need to be chunked. If <code>chunking</code> is <code>Max</code>, all the new chunks will be of size <code>max_size</code>.</p><p>Fail with <code>Invalid_argument</code> if <code>size</code> is smaller than <code>min_size</code>. <code>min_size</code> is, by default, set to 4000 (to avoid hash collisions on smaller sizes) but can be tweaked for testing purposes. <i>Notes:</i> the smaller <code>size</code> is, the bigger the risk of hash collisions, so use reasonable values.</p></dd></dl><dl><dt class="spec module" id="module-Content_addressable"><a href="#module-Content_addressable" class="anchor"></a><code><span class="keyword">module</span> <a href="Content_addressable/index.html">Content_addressable</a> : <span class="keyword">functor</span> (<a href="Content_addressable/argument-1-S/index.html">S</a> : <a href="../../irmin/Irmin/index.html#module-type-APPEND_ONLY_STORE_MAKER">Irmin.APPEND_ONLY_STORE_MAKER</a>) <span>&#45;&gt;</span> <a href="../../irmin/Irmin/index.html#module-type-CONTENT_ADDRESSABLE_STORE_MAKER">Irmin.CONTENT_ADDRESSABLE_STORE_MAKER</a></code></dt><dd><p><code>Content_addressable(X)</code> is a content-addressable store which store values cut into chunks into the underlying store <code>X</code>.</p></dd></dl></section></div></body></html>