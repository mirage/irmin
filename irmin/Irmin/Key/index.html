<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Key (irmin.Irmin.Key)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">irmin</a> &#x00BB; <a href="../index.html">Irmin</a> &#x00BB; Key</nav><header class="odoc-preamble"><h1>Module <code><span>Irmin.Key</span></code></h1><p>Module types for <i>keys</i> into an arbitrary store.</p></header><nav class="odoc-toc"><ul><li><a href="#choices-of-key-representation">Choices of key representation</a><ul><li><a href="#hash-like-keys">Hash-like keys</a></li><li><a href="#non-hash-like-keys">Non-hash-like keys</a></li></ul></li></ul></nav><div class="odoc-content"><h3 id="choices-of-key-representation"><a href="#choices-of-key-representation" class="anchor"></a>Choices of key representation</h3><h4 id="hash-like-keys"><a href="#hash-like-keys" class="anchor"></a>Hash-like keys</h4><p>Most Irmin stores are keyed directly by a <i>hash</i> of the values that they store. This results in a so-called &quot;content-addressable&quot; store, in which all possible contents values have exactly one key. The key is derived from the value via <code>hash</code> and, given a key, the corresponding value can be retrieved from the store via <code>find</code>:</p><pre class="language-ocaml"><code>                ┌───────────────────────────────┐
                │                               │
┌───────┐       v    find   ┌───────┐  hash   ┌─────┐
│ Store │ ──&gt;  (+)  ──────&gt; │ Value │ ──────&gt; │ Key │
└───────┘                   └───────┘         └─────┘</code></pre><p>Keys built this way – with a 1:1 correspondence between the key and the hash, are known as <a href="module-type-Hash_like/index.html"><code>Hash_like</code></a>. This class of key representation has some important properties:</p><ul><li><b>irredundant storage</b>: given that an object's key is derived directly from its representation, there can be at most one copy of any content value in the store at one time – the store is naturally free of duplicates.</li></ul><ul><li><b>reproducibility</b>: again, because keys are derived directly from values, multiple parties are guaranteed to compute the same store keys for a given set of stored values.</li></ul><p>However, it also has some disadvantages. Implementing a hash-keyed store requires some mechanism for mapping hashes to their physical location (e.g. their offset on disk), called an &quot;index&quot;. This auxiliary index occupies space, and must be queried for each pointer in the store (even for internal pointers between nodes along a path).</p><h4 id="non-hash-like-keys"><a href="#non-hash-like-keys" class="anchor"></a>Non-hash-like keys</h4><p>For this reason, Irmin allows backends to supply custom key representations that do not satisfy the above properties (i.e. not irredundant, and not reproducible). This leads to the following more complex set of relationships between the values:</p><pre class="language-ocaml"><code>               ┌────────────────────────────────────────────────────────┐
               │                                                        │
  ┌············┼··········································┐             │
  :            │                                          :             │
┌───────┐      v    find  ┌───────┐  hash   ┌──────┐      v   index   ┌─────┐
│ Store │ ──&gt; (+) ──────&gt; │ Value │ ──────&gt; │ Hash │ ··&gt; (+) ·······&gt; │ Key │
└───────┘                 └───────┘         └──────┘                  └─────┘
  │                          v                 ∧        to_hash         │ ^
  └───────────────────────&gt; (+)                └────────────────────────┘ │
                             │       add                                  │
                             └────────────────────────────────────────────┘</code></pre><p>In general, the key of a value isn't known until it has been added to a particular store, and keys need not be portable between different stores. It's still required that keys be convertible to hashes, as this ensures the consistency of Irmin's Merkle tree structure.</p><p>Stores that use non-hash-like keys are not content-addressable, since the user can't compute the key of a value given the value itself (and perhaps a value has more than one possible key).</p><p>Implementer's note: all key implementations must have a pre-hash implementation derived in terms of <code>Key.to_hash</code>. That is, for all keys <code>k</code>, given <code>h = Key.to_hash k</code> then <code>Irmin.Type.pre_hash key_t k</code> must equal <code>Irmin.Type.pre_hash hash_t h</code>.</p><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Hash_like"><a href="#module-type-Hash_like" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Hash_like/index.html">Hash_like</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Of_hash"><a href="#module-Of_hash" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Of_hash/index.html">Of_hash</a></span><span> (<a href="Of_hash/index.html#argument-1-H">H</a> : <a href="../Type/module-type-S/index.html">Type.S</a>) : <a href="module-type-Hash_like/index.html">Hash_like</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Hash_like/index.html#type-t">t</a> = <span class="xref-unresolved">H</span>.t</span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-Hash_like/index.html#type-hash">hash</a> = <span class="xref-unresolved">H</span>.t</span></span></code></div><div class="spec-doc"><p>The simplest possible <code>Key</code> implementation is just a hash of the corresponding value, attaching no additional metadata about the value.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Store_spec"><a href="#module-Store_spec" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Store_spec/index.html">Store_spec</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>