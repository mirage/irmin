<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store (irmin-containers.Irmin_containers.Linked_log.Make.Store)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">irmin-containers</a> &#x00BB; <a href="../../../index.html">Irmin_containers</a> &#x00BB; <a href="../../index.html">Linked_log</a> &#x00BB; <a href="../index.html">Make</a> &#x00BB; Store</nav><header class="odoc-preamble"><h1>Module <code><span>Make.Store</span></code></h1><p>Store for the log. All store related operations like branching, cloning, merging, etc are done through this module.</p></header><nav class="odoc-toc"><ul><li><a href="#irmin-stores">Irmin stores</a></li><li><a href="#reads">Reads</a></li><li><a href="#updates">Updates</a></li><li><a href="#clones">Clones</a></li><li><a href="#watches">Watches</a></li><li><a href="#merges-and-common-ancestors">Merges and Common Ancestors</a></li><li><a href="#history">History</a><ul><li><a href="#converters-to-backend-types">Converters to backend types</a></li></ul></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-hash"><a href="#type-hash" class="anchor"></a><code><span><span class="keyword">type</span> hash</span></code></div></div><h2 id="irmin-stores"><a href="#irmin-stores" class="anchor"></a>Irmin stores</h2><p>Irmin stores are tree-like read-write stores with extended capabilities. They allow an application (or a collection of applications) to work with multiple local states, which can be forked and merged programmatically, without having to rely on a global state. In a way very similar to version control systems, Irmin local states are called <i>branches</i>.</p><p>There are two kinds of store in Irmin: the ones based on <a href="#val-of_branch" title="of_branch">persistent</a> named branches and the ones based <a href="#val-of_commit" title="of_commit">temporary</a> detached heads. These exist relative to a local, larger (and shared) store, and have some (shared) contents. This is exactly the same as usual version control systems, that the informed user can see as an implicit purely functional data-structure.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Schema"><a href="#module-Schema" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Schema/index.html">Schema</a></span><span> : 
  <a href="../../../../../irmin/Irmin/Schema/module-type-S/index.html">Irmin.Schema.S</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Schema/module-type-S/Hash/index.html#type-t">Hash.t</a> = <a href="#type-hash">hash</a></span>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Schema/module-type-S/Path/index.html#type-step">Path.step</a> = string</span>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Schema/module-type-S/Path/index.html#type-t">Path.t</a> = <span>string list</span></span>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Schema/module-type-S/Branch/index.html#type-t">Branch.t</a> = string</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-repo"><a href="#type-repo" class="anchor"></a><code><span><span class="keyword">type</span> repo</span></code></div><div class="spec-doc"><p>The type for Irmin repositories.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for Irmin stores.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-step"><a href="#type-step" class="anchor"></a><code><span><span class="keyword">type</span> step</span><span> = <a href="Schema/Path/index.html#type-step">Schema.Path.step</a></span></code></div><div class="spec-doc"><p>The type for <code>key</code> steps.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-step_t"><a href="#val-step_t" class="anchor"></a><code><span><span class="keyword">val</span> step_t : <span><a href="#type-step">step</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-path"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <a href="Schema/Path/index.html#type-t">Schema.Path.t</a></span></code></div><div class="spec-doc"><p>The type for store keys. A key is a sequence of <a href="#type-step"><code>step</code></a>s.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-path_t"><a href="#val-path_t" class="anchor"></a><code><span><span class="keyword">val</span> path_t : <span><a href="#type-path">path</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-metadata"><a href="#type-metadata" class="anchor"></a><code><span><span class="keyword">type</span> metadata</span><span> = <a href="Schema/Metadata/index.html#type-t">Schema.Metadata.t</a></span></code></div><div class="spec-doc"><p>The type for store metadata.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metadata_t"><a href="#val-metadata_t" class="anchor"></a><code><span><span class="keyword">val</span> metadata_t : <span><a href="#type-metadata">metadata</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-contents"><a href="#type-contents" class="anchor"></a><code><span><span class="keyword">type</span> contents</span><span> = <a href="Schema/Contents/index.html#type-t">Schema.Contents.t</a></span></code></div><div class="spec-doc"><p>The type for store contents.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-contents_t"><a href="#val-contents_t" class="anchor"></a><code><span><span class="keyword">val</span> contents_t : <span><a href="#type-contents">contents</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-node"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> node</span></code></div><div class="spec-doc"><p>The type for store nodes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-node_t"><a href="#val-node_t" class="anchor"></a><code><span><span class="keyword">val</span> node_t : <span><a href="#type-node">node</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span></code></div><div class="spec-doc"><p>The type for store trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tree_t"><a href="#val-tree_t" class="anchor"></a><code><span><span class="keyword">val</span> tree_t : <span><a href="#type-tree">tree</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash_t"><a href="#val-hash_t" class="anchor"></a><code><span><span class="keyword">val</span> hash_t : <span><a href="#type-hash">hash</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-commit"><a href="#type-commit" class="anchor"></a><code><span><span class="keyword">type</span> commit</span></code></div><div class="spec-doc"><p>Type for <code>`Commit</code> identifiers. Similar to Git's commit SHA1s.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commit_t"><a href="#val-commit_t" class="anchor"></a><code><span><span class="keyword">val</span> commit_t : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-commit">commit</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>commit_t r</code> is the value type for <a href="#type-commit"><code>commit</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-branch"><a href="#type-branch" class="anchor"></a><code><span><span class="keyword">type</span> branch</span><span> = <a href="Schema/Branch/index.html#type-t">Schema.Branch.t</a></span></code></div><div class="spec-doc"><p>Type for persistent branch names. Branches usually share a common global namespace and it's the user's responsibility to avoid name clashes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branch_t"><a href="#val-branch_t" class="anchor"></a><code><span><span class="keyword">val</span> branch_t : <span><a href="#type-branch">branch</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-slice"><a href="#type-slice" class="anchor"></a><code><span><span class="keyword">type</span> slice</span></code></div><div class="spec-doc"><p>Type for store slices.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slice_t"><a href="#val-slice_t" class="anchor"></a><code><span><span class="keyword">val</span> slice_t : <span><a href="#type-slice">slice</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-info"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = <a href="Schema/Info/index.html#type-t">Schema.Info.t</a></span></code></div><div class="spec-doc"><p>The type for commit info.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-info_t"><a href="#val-info_t" class="anchor"></a><code><span><span class="keyword">val</span> info_t : <span><a href="#type-info">info</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-lca_error"><a href="#type-lca_error" class="anchor"></a><code><span><span class="keyword">type</span> lca_error</span><span> = </span><span>[ </span></code><ol><li id="type-lca_error.Max_depth_reached" class="def variant constructor anchored"><a href="#type-lca_error.Max_depth_reached" class="anchor"></a><code><span>| </span><span>`Max_depth_reached</span></code></li><li id="type-lca_error.Too_many_lcas" class="def variant constructor anchored"><a href="#type-lca_error.Too_many_lcas" class="anchor"></a><code><span>| </span><span>`Too_many_lcas</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for errors associated with functions computing least common ancestors</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lca_error_t"><a href="#val-lca_error_t" class="anchor"></a><code><span><span class="keyword">val</span> lca_error_t : <span><a href="#type-lca_error">lca_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ff_error"><a href="#type-ff_error" class="anchor"></a><code><span><span class="keyword">type</span> ff_error</span><span> = </span><span>[ </span></code><ol><li id="type-ff_error.No_change" class="def variant constructor anchored"><a href="#type-ff_error.No_change" class="anchor"></a><code><span>| </span><span>`No_change</span></code></li><li id="type-ff_error.Rejected" class="def variant constructor anchored"><a href="#type-ff_error.Rejected" class="anchor"></a><code><span>| </span><span>`Rejected</span></code></li><li id="type-ff_error.lca_error" class="def variant type anchored"><a href="#type-ff_error.lca_error" class="anchor"></a><code><span>| </span><span><a href="#type-lca_error">lca_error</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for errors for <a href="Head/index.html#val-fast_forward"><code>Head.fast_forward</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ff_error_t"><a href="#val-ff_error_t" class="anchor"></a><code><span><span class="keyword">val</span> ff_error_t : <span><a href="#type-ff_error">ff_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Info"><a href="#module-Info" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Info/index.html">Info</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-contents_key"><a href="#type-contents_key" class="anchor"></a><code><span><span class="keyword">type</span> contents_key</span><span> = <a href="#type-hash">hash</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-contents_key_t"><a href="#val-contents_key_t" class="anchor"></a><code><span><span class="keyword">val</span> contents_key_t : <span><a href="#type-contents_key">contents_key</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-node_key"><a href="#type-node_key" class="anchor"></a><code><span><span class="keyword">type</span> node_key</span><span> = <a href="#type-hash">hash</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-node_key_t"><a href="#val-node_key_t" class="anchor"></a><code><span><span class="keyword">val</span> node_key_t : <span><a href="#type-node_key">node_key</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-commit_key"><a href="#type-commit_key" class="anchor"></a><code><span><span class="keyword">type</span> commit_key</span><span> = <a href="#type-hash">hash</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commit_key_t"><a href="#val-commit_key_t" class="anchor"></a><code><span><span class="keyword">val</span> commit_key_t : <span><a href="#type-commit_key">commit_key</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Repo"><a href="#module-Repo" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Repo/index.html">Repo</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Repositories.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>empty repo</code> is a temporary, empty store. Becomes a normal temporary store after the first update.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-main"><a href="#val-main" class="anchor"></a><code><span><span class="keyword">val</span> main : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>main r</code> is a persistent store based on <code>r</code>'s main branch. This operation is cheap, can be repeated multiple times.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_branch"><a href="#val-of_branch" class="anchor"></a><code><span><span class="keyword">val</span> of_branch : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-branch">branch</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>of_branch r name</code> is a persistent store based on the branch <code>name</code>. Similar to <a href="#val-main"><code>main</code></a>, but use <code>name</code> instead of <a href="../../../../../irmin/Irmin/Branch/module-type-S/index.html#val-main"><code>Irmin.Branch.S.main</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_commit"><a href="#val-of_commit" class="anchor"></a><code><span><span class="keyword">val</span> of_commit : <span><a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>of_commit c</code> is a temporary store, based on the commit <code>c</code>.</p><p>Temporary stores do not have stable names: instead they can be addressed using the hash of the current commit. Temporary stores are similar to Git's detached heads. In a temporary store, all the operations are performed relative to the current head and update operations can modify the current head: the current stores's head will automatically become the new head obtained after performing the update.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-repo"><a href="#val-repo" class="anchor"></a><code><span><span class="keyword">val</span> repo : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-repo">repo</a></span></code></div><div class="spec-doc"><p><code>repo t</code> is the repository containing <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tree"><a href="#val-tree" class="anchor"></a><code><span><span class="keyword">val</span> tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>tree t</code> is <code>t</code>'s current tree. Contents is not allowed at the root of the tree.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Status"><a href="#module-Status" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Status/index.html">Status</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-status"><a href="#val-status" class="anchor"></a><code><span><span class="keyword">val</span> status : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Status/index.html#type-t">Status.t</a></span></code></div><div class="spec-doc"><p><code>status t</code> is <code>t</code>'s status. It can either be a branch, a commit or empty.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Head"><a href="#module-Head" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Head/index.html">Head</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Managing the store's heads.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Hash"><a href="#module-Hash" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Hash/index.html">Hash</a></span><span> : <a href="../../../../../irmin/Irmin/Hash/module-type-S/index.html">Irmin.Hash.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Hash/module-type-S/index.html#type-t">t</a> = <a href="#type-hash">hash</a></span></span></code></div><div class="spec-doc"><p>Object hashes.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Commit"><a href="#module-Commit" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Commit/index.html">Commit</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Commit</code> defines immutable objects to describe store updates.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Contents"><a href="#module-Contents" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Contents/index.html">Contents</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Contents</code> provides base functions for the store's contents.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tree/index.html">Tree</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Managing store's trees.</p></div></div><h2 id="reads"><a href="#reads" class="anchor"></a>Reads</h2><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>[ `Contents <span>| `Node</span> ]</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>kind</code> is <a href="Tree/index.html#val-kind"><code>Tree.kind</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-step">step</a> * <a href="#type-tree">tree</a>)</span> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>list t</code> is <a href="Tree/index.html#val-list"><code>Tree.list</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mem t</code> is <a href="Tree/index.html#val-mem"><code>Tree.mem</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><code><span><span class="keyword">val</span> mem_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mem_tree t</code> is <a href="Tree/index.html#val-mem_tree"><code>Tree.mem_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all"><a href="#val-find_all" class="anchor"></a><code><span><span class="keyword">val</span> find_all : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-contents">contents</a> * <a href="#type-metadata">metadata</a>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_all t</code> is <a href="Tree/index.html#val-find_all"><code>Tree.find_all</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-contents">contents</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find t</code> is <a href="Tree/index.html#val-find"><code>Tree.find</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_all"><a href="#val-get_all" class="anchor"></a><code><span><span class="keyword">val</span> get_all : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-contents">contents</a> * <a href="#type-metadata">metadata</a>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_all t</code> is <a href="Tree/index.html#val-get_all"><code>Tree.get_all</code></a> applied on <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-contents">contents</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get t</code> is <a href="Tree/index.html#val-get"><code>Tree.get</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><code><span><span class="keyword">val</span> find_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_tree t</code> is <a href="Tree/index.html#val-find_tree"><code>Tree.find_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_tree"><a href="#val-get_tree" class="anchor"></a><code><span><span class="keyword">val</span> get_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_tree t k</code> is <a href="Tree/index.html#val-get_tree"><code>Tree.get_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-kinded_key"><a href="#type-kinded_key" class="anchor"></a><code><span><span class="keyword">type</span> kinded_key</span><span> := </span><span>[ </span></code><ol><li id="type-kinded_key.Contents" class="def variant constructor anchored"><a href="#type-kinded_key.Contents" class="anchor"></a><code><span>| </span><span>`Contents <span class="keyword">of</span> <a href="#type-contents_key">contents_key</a></span></code></li><li id="type-kinded_key.Node" class="def variant constructor anchored"><a href="#type-kinded_key.Node" class="anchor"></a><code><span>| </span><span>`Node <span class="keyword">of</span> <a href="#type-node_key">node_key</a></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-key"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-kinded_key">kinded_key</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>id t k</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-hash">hash</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>hash t k</code></p></div></div><h2 id="updates"><a href="#updates" class="anchor"></a>Updates</h2><div class="odoc-spec"><div class="spec type anchored" id="type-write_error"><a href="#type-write_error" class="anchor"></a><code><span><span class="keyword">type</span> write_error</span><span> = </span><span>[ </span></code><ol><li id="type-write_error.Irmin.Merge.conflict" class="def variant type anchored"><a href="#type-write_error.Irmin.Merge.conflict" class="anchor"></a><code><span>| </span><span><a href="../../../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a></span></code></li><li id="type-write_error.Too_many_retries" class="def variant constructor anchored"><a href="#type-write_error.Too_many_retries" class="anchor"></a><code><span>| </span><span>`Too_many_retries <span class="keyword">of</span> int</span></code></li><li id="type-write_error.Test_was" class="def variant constructor anchored"><a href="#type-write_error.Test_was" class="anchor"></a><code><span>| </span><span>`Test_was <span class="keyword">of</span> <span><a href="#type-tree">tree</a> option</span></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for write errors.</p><ul><li>Merge conflict.</li><li>Concurrent transactions are competing to get the current operation committed and too many attemps have been tried (livelock).</li><li>A &quot;test and set&quot; operation has failed and the current value is <code>v</code> instead of the one we were waiting for.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_error_t"><a href="#val-write_error_t" class="anchor"></a><code><span><span class="keyword">val</span> write_error_t : <span><a href="#type-write_error">write_error</a> <a href="../../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-contents">contents</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set t k ~info v</code> sets <code>k</code> to the value <code>v</code> in <code>t</code>. Discard any previous results but ensure that no operation is lost in the history.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-set_tree"><code>set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>When <code>clear</code> is set (the default), the tree cache is emptied upon the function's completion, mirroring the effect of invoking <a href="Tree/index.html#val-clear"><code>Tree.clear</code></a>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_exn"><a href="#val-set_exn" class="anchor"></a><code><span><span class="keyword">val</span> set_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-contents">contents</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_exn</code> is like <a href="#val-set"><code>set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_tree"><a href="#val-set_tree" class="anchor"></a><code><span><span class="keyword">val</span> set_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_tree</code> is like <a href="#val-set"><code>set</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_tree_exn"><a href="#val-set_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> set_tree_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_tree</code> is like <a href="#val-set_exn"><code>set_exn</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>remove t ~info k</code> remove any bindings to <code>k</code> in <code>t</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_exn"><a href="#val-remove_exn" class="anchor"></a><code><span><span class="keyword">val</span> remove_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>remove_exn</code> is like <a href="#val-remove"><code>remove</code></a> but raise <code>Failure _</code> instead of a using result type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_and_set"><a href="#val-test_and_set" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_and_set ~test ~set</code> is like <a href="#val-set"><code>set</code></a> but it atomically checks that the tree is <code>test</code> before modifying it to <code>set</code>.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-test_and_set_tree"><code>test_and_set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Test t)</code> if the current tree is <code>t</code> instead of <code>test</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_and_set_exn"><a href="#val-test_and_set_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_and_set_exn</code> is like <a href="#val-test_and_set"><code>test_and_set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_and_set_tree"><a href="#val-test_and_set_tree" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_and_set_tree</code> is like <a href="#val-test_and_set"><code>test_and_set</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_and_set_tree_exn"><a href="#val-test_and_set_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_tree_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_and_set_tree_exn</code> is like <a href="#val-test_and_set_exn"><code>test_and_set_exn</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_set_and_get"><a href="#val-test_set_and_get" class="anchor"></a><code><span><span class="keyword">val</span> test_set_and_get : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="#type-commit">commit</a> option</span>, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_set_and_get</code> is like <a href="#val-test_and_set"><code>test_and_set</code></a> except it also returns the commit associated with updating the store with the new value if the <code>test_and_set</code> is successful. No commit is returned if there was no update to the store.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_set_and_get_exn"><a href="#val-test_set_and_get_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_set_and_get_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-commit">commit</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_set_and_get_exn</code> is like <a href="#val-test_set_and_get"><code>test_set_and_get</code></a> but raises <code>Failure _</code> instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_set_and_get_tree"><a href="#val-test_set_and_get_tree" class="anchor"></a><code><span><span class="keyword">val</span> test_set_and_get_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="#type-commit">commit</a> option</span>, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_set_and_get_tree</code> is like <a href="#val-test_set_and_get"><code>test_set_and_get</code></a> but for a <a href="#val-tree"><code>tree</code></a></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_set_and_get_tree_exn"><a href="#val-test_set_and_get_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_set_and_get_tree_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">set</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-commit">commit</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>test_set_and_get_tree_exn</code> is like <a href="#val-test_set_and_get_tree"><code>test_set_and_get_tree</code></a> but raises <code>Failure _</code> instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge"><a href="#val-merge" class="anchor"></a><code><span><span class="keyword">val</span> merge : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">old</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>merge ~old</code> is like <a href="#val-set"><code>set</code></a> but merge the current tree and the new tree using <code>old</code> as ancestor in case of conflicts.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-merge_tree"><code>merge_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Conflict c)</code> if the merge failed with the conflict <code>c</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_exn"><a href="#val-merge_exn" class="anchor"></a><code><span><span class="keyword">val</span> merge_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">old</span>:<span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-contents">contents</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>merge_exn</code> is like <a href="#val-merge"><code>merge</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_tree"><a href="#val-merge_tree" class="anchor"></a><code><span><span class="keyword">val</span> merge_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">old</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>merge_tree</code> is like <a href="#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_tree_exn"><a href="#val-merge_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> merge_tree_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">old</span>:<span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>merge_tree</code> is like <a href="#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_tree"><a href="#val-with_tree" class="anchor"></a><code><span><span class="keyword">val</span> with_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?strategy</span>:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="#type-write_error">write_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>with_tree t k ~info f</code> replaces <i>atomically</i> the subtree <code>v</code> under <code>k</code> in the store <code>t</code> by the contents of the tree <code>f v</code>, using the commit info <code>info ()</code>.</p><p>If <code>v = f v</code> and <code>allow_empty</code> is unset (default) then, the operation is a no-op.</p><p>If <code>v != f v</code> and no other changes happen concurrently, <code>f v</code> becomes the new subtree under <code>k</code>. If other changes happen concurrently to that operations, the semantics depend on the value of <code>strategy</code>:</p><ul><li>if <code>strategy = `Set</code>, use <a href="#val-set"><code>set</code></a> and discard any concurrent updates to <code>k</code>.</li><li>if <code>strategy = `Test_and_set</code> (default), use <a href="#val-test_and_set"><code>test_and_set</code></a> and ensure that no concurrent operations are updating <code>k</code>.</li><li>if <code>strategy = `Merge</code>, use <a href="#val-merge"><code>merge</code></a> and ensure that concurrent updates and merged with the values present at the beginning of the transaction.</li></ul><p><b>Note:</b> Irmin transactions provides <a href="https://en.wikipedia.org/wiki/Snapshot_isolation">snapshot isolation</a> guarantees: reads and writes are isolated in every transaction, but only write conflicts are visible on commit.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_tree_exn"><a href="#val-with_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> with_tree_exn : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_empty</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parents</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?strategy</span>:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>with_tree_exn</code> is like <a href="#val-with_tree"><code>with_tree</code></a> but raise <code>Failure _</code> instead of using a return type.</p></div></div><h2 id="clones"><a href="#clones" class="anchor"></a>Clones</h2><div class="odoc-spec"><div class="spec value anchored" id="val-clone"><a href="#val-clone" class="anchor"></a><code><span><span class="keyword">val</span> clone : <span><span class="label">src</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">dst</span>:<a href="#type-branch">branch</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>clone ~src ~dst</code> makes <code>dst</code> points to <code>Head.get src</code>. <code>dst</code> is created if needed. Remove the current contents en <code>dst</code> if <code>src</code> is <a href="#val-empty"><code>empty</code></a>.</p></div></div><h2 id="watches"><a href="#watches" class="anchor"></a>Watches</h2><div class="odoc-spec"><div class="spec type anchored" id="type-watch"><a href="#type-watch" class="anchor"></a><code><span><span class="keyword">type</span> watch</span></code></div><div class="spec-doc"><p>The type for store watches.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-watch"><a href="#val-watch" class="anchor"></a><code><span><span class="keyword">val</span> watch : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?init</span>:<a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><a href="#type-commit">commit</a> <a href="../../../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-watch">watch</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>watch t f</code> calls <code>f</code> every time the contents of <code>t</code>'s head is updated.</p><p><b>Note:</b> even if <code>f</code> might skip some head updates, it will never be called concurrently: all consecutive calls to <code>f</code> are done in sequence, so we ensure that the previous one ended before calling the next one.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-watch_key"><a href="#val-watch_key" class="anchor"></a><code><span><span class="keyword">val</span> watch_key : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?init</span>:<a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span>(<a href="#type-commit">commit</a> * <a href="#type-tree">tree</a>)</span> <a href="../../../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-watch">watch</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>watch_key t key f</code> calls <code>f</code> every time the <code>key</code>'s value is added, removed or updated. If the current branch is deleted, no signal is sent to the watcher.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unwatch"><a href="#val-unwatch" class="anchor"></a><code><span><span class="keyword">val</span> unwatch : <span><a href="#type-watch">watch</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>unwatch w</code> disable <code>w</code>. Return once the <code>w</code> is fully disabled.</p></div></div><h2 id="merges-and-common-ancestors"><a href="#merges-and-common-ancestors" class="anchor"></a>Merges and Common Ancestors</h2><div class="odoc-spec"><div class="spec type anchored" id="type-merge"><a href="#type-merge" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a merge</span></span><span> =
  <span><span class="label">info</span>:<a href="Info/index.html#type-f">Info.f</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_depth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?n</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <a href="../../../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>The type for merge functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_into"><a href="#val-merge_into" class="anchor"></a><code><span><span class="keyword">val</span> merge_into : <span><span class="label">into</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p><code>merge_into ~into:x ~info:i t</code> merges <code>t</code>'s current branch into <code>x</code>'s current branch using the info <code>i</code>. After that operation, the two stores are still independent. Similar to <code>git merge &lt;branch&gt;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_with_branch"><a href="#val-merge_with_branch" class="anchor"></a><code><span><span class="keyword">val</span> merge_with_branch : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-branch">branch</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-merge"><code>merge</code></a> but with a branch ID.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_with_commit"><a href="#val-merge_with_commit" class="anchor"></a><code><span><span class="keyword">val</span> merge_with_commit : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-commit">commit</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-merge"><code>merge</code></a> but with a commit_id.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lcas"><a href="#val-lcas" class="anchor"></a><code><span><span class="keyword">val</span> lcas : 
  <span><span class="optlabel">?max_depth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?n</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="#type-commit">commit</a> list</span>, <a href="#type-lca_error">lca_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>lca ?max_depth ?n msg t1 t2</code> returns the collection of least common ancestors between the heads of <code>t1</code> and <code>t2</code> branches.</p><ul><li><code>max_depth</code> is the maximum depth of the exploration (default is <code>max_int</code>). Return <code>Error `Max_depth_reached</code> if this depth is exceeded.</li><li><code>n</code> is the maximum expected number of lcas. Stop the exploration as soon as <code>n</code> lcas are found. Return <code>Error `Too_many_lcas</code> if more <code>lcas</code> are found.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lcas_with_branch"><a href="#val-lcas_with_branch" class="anchor"></a><code><span><span class="keyword">val</span> lcas_with_branch : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_depth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?n</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-branch">branch</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="#type-commit">commit</a> list</span>, <a href="#type-lca_error">lca_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-lcas"><code>lcas</code></a> but takes a branch ID as argument.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lcas_with_commit"><a href="#val-lcas_with_commit" class="anchor"></a><code><span><span class="keyword">val</span> lcas_with_commit : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_depth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?n</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="#type-commit">commit</a> list</span>, <a href="#type-lca_error">lca_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-lcas"><code>lcas</code></a> but takes a commmit as argument.</p></div></div><h2 id="history"><a href="#history" class="anchor"></a>History</h2><div class="odoc-spec"><div class="spec module anchored" id="module-History"><a href="#module-History" class="anchor"></a><code><span><span class="keyword">module</span> History</span><span> : <span class="xref-unresolved">Graph</span>.Sig.P <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">V.t</span> = <span class="xref-unresolved">commit</span></span></span></code></div><div class="spec-doc"><p>An history is a DAG of heads.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-history"><a href="#val-history" class="anchor"></a><code><span><span class="keyword">val</span> history : 
  <span><span class="optlabel">?depth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?min</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max</span>:<span><a href="#type-commit">commit</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">History</span>.t <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>history ?depth ?min ?max t</code> is a view of the history of the store <code>t</code>, of depth at most <code>depth</code>, starting from the <code>t</code>'s head (or from <code>max</code> if the head is not set) and stopping at <code>min</code> if specified.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-last_modified"><a href="#val-last_modified" class="anchor"></a><code><span><span class="keyword">val</span> last_modified : <span><span class="optlabel">?depth</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?n</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-commit">commit</a> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>last_modified ?number c k</code> is the list of the last <code>number</code> commits that modified <code>path</code>, in ascending order of date. <code>depth</code> is the maximum depth to be explored in the commit graph, if any. Default value for <code>number</code> is 1.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Branch"><a href="#module-Branch" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Branch/index.html">Branch</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Manipulate branches.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Path"><a href="#module-Path" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Path/index.html">Path</a></span><span> : <a href="../../../../../irmin/Irmin/Path/module-type-S/index.html">Irmin.Path.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Path/module-type-S/index.html#type-t">t</a> = <a href="#type-path">path</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Path/module-type-S/index.html#type-step">step</a> = <a href="#type-step">step</a></span></span></code></div><div class="spec-doc"><p><code>Path</code> provides base functions for the stores's paths.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Metadata"><a href="#module-Metadata" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Metadata/index.html">Metadata</a></span><span> : <a href="../../../../../irmin/Irmin/Metadata/module-type-S/index.html">Irmin.Metadata.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Metadata/module-type-S/index.html#type-t">t</a> = <a href="#type-metadata">metadata</a></span></span></code></div><div class="spec-doc"><p><code>Metadata</code> provides base functions for node metadata.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Backend"><a href="#module-Backend" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Backend/index.html">Backend</a></span><span> : 
  <a href="../../../../../irmin/Irmin/Backend/module-type-S/index.html">Irmin.Backend.S</a>
    <span class="keyword">with</span> <span><span class="keyword">module</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Schema/index.html">Schema</a> = <a href="Schema/index.html">Schema</a></span>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Slice/index.html#type-t">Slice.t</a> = <a href="#type-slice">slice</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Repo/index.html#type-t">Repo.t</a> = <a href="#type-repo">repo</a></span>
     <span class="keyword">and</span> <span><span class="keyword">module</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Hash/index.html">Hash</a> = <a href="Hash/index.html">Hash</a></span>
     <span class="keyword">and</span> <span><span class="keyword">module</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Node/Path/index.html">Node.Path</a> = <a href="Path/index.html">Path</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Contents/index.html#type-key">Contents.key</a> = <a href="#type-contents_key">contents_key</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Node/index.html#type-key">Node.key</a> = <a href="#type-node_key">node_key</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../../../irmin/Irmin/Backend/module-type-S/Commit/index.html#type-key">Commit.key</a> = <a href="#type-commit_key">commit_key</a></span></span></code></div><div class="spec-doc"><p>Backend functions, which might be used by the backends.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-E"><a href="#extension-decl-E" class="anchor"></a><code><span><span class="keyword">type</span> <span class="xref-unresolved">Irmin__.Remote.t</span> += </span></code><ol><li id="extension-E" class="def variant extension anchored"><a href="#extension-E" class="anchor"></a><code><span>| </span><span><span class="extension">E</span> <span class="keyword">of</span> <a href="Backend/Remote/index.html#type-endpoint">Backend.Remote.endpoint</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Extend the <code>remote</code> type with <code>endpoint</code>.</p><span class="comment-delim">*)</span></div></li></ol></div></div><h3 id="converters-to-backend-types"><a href="#converters-to-backend-types" class="anchor"></a>Converters to backend types</h3><div class="odoc-spec"><div class="spec value anchored" id="val-of_backend_node"><a href="#val-of_backend_node" class="anchor"></a><code><span><span class="keyword">val</span> of_backend_node : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Backend/Node/index.html#type-value">Backend.Node.value</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_backend_node"><a href="#val-to_backend_node" class="anchor"></a><code><span><span class="keyword">val</span> to_backend_node : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Backend/Node/index.html#type-value">Backend.Node.value</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_backend_portable_node"><a href="#val-to_backend_portable_node" class="anchor"></a><code><span><span class="keyword">val</span> to_backend_portable_node : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Backend</span>.Node_portable.t <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_backend_commit"><a href="#val-to_backend_commit" class="anchor"></a><code><span><span class="keyword">val</span> to_backend_commit : <span><a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span> <a href="Backend/Commit/index.html#type-value">Backend.Commit.value</a></span></code></div><div class="spec-doc"><p><code>to_backend_commit c</code> is the backend commit object associated with the commit <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_backend_commit"><a href="#val-of_backend_commit" class="anchor"></a><code><span><span class="keyword">val</span> of_backend_commit : 
  <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Backend/Commit/Key/index.html#type-t">Backend.Commit.Key.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Backend/Commit/index.html#type-value">Backend.Commit.value</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-commit">commit</a></span></code></div><div class="spec-doc"><p><code>of_backend_commit r k c</code> is the commit associated with the backend commit object <code>c</code> that hash key <code>k</code> in <code>r</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_contents"><a href="#val-save_contents" class="anchor"></a><code><span><span class="keyword">val</span> save_contents : 
  <span><span><span>[&gt; <a href="../../../../../irmin/Irmin/Perms/index.html#type-write">Irmin.Perms.write</a> ]</span> <a href="Backend/Contents/index.html#type-t">Backend.Contents.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-contents">contents</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-contents_key">contents_key</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Save a content into the database</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_tree"><a href="#val-save_tree" class="anchor"></a><code><span><span class="keyword">val</span> save_tree : 
  <span><span class="optlabel">?clear</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[&gt; <a href="../../../../../irmin/Irmin/Perms/index.html#type-write">Irmin.Perms.write</a> ]</span> <a href="Backend/Contents/index.html#type-t">Backend.Contents.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[&gt; <a href="../../../../../irmin/Irmin/Perms/index.html#type-read_write">Irmin.Perms.read_write</a> ]</span> <a href="Backend/Node/index.html#type-t">Backend.Node.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-kinded_key">kinded_key</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Save a tree into the database. Does not do any reads.</p><p>When <code>clear</code> is set (the default), the tree cache is emptied upon the function's completion, mirroring the effect of invoking <a href="Tree/index.html#val-clear"><code>Tree.clear</code></a>.</p></div></div><p><code>Deprecated</code></p><div class="odoc-spec"><div class="spec value anchored" id="val-master"><a href="#val-master" class="anchor"></a><code><span><span class="keyword">val</span> master : <span><a href="#type-repo">repo</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> <p>Use <a href="#val-main"><code>main</code></a> instead</p></li></ul></div></div></div></body></html>
